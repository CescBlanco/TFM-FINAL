# Predicci√≥n de Abandono en Abonados de Centros Deportivos mediante T√©cnicas de Machine Learning  
*(Caso aplicado al Centre Municipal Horta Esportiva ‚Äì CEM Horta, Barcelona)*

## üß† Contexto del proyecto:

En el sector del fitness, la **retenci√≥n de abonados** es uno de los principales retos de sostenibilidad. Los centros deportivos suelen enfrentar **tasas de abandono (churn)** superiores al 30 % anual, lo que impacta directamente en ingresos, planificaci√≥n de recursos y estabilidad operativa.

Este proyecto aborda ese desaf√≠o en el **Centre Municipal Horta Esportiva (CEM Horta)**, aplicando **t√©cnicas de Machine Learning** para predecir la probabilidad de baja de cada abonado y ofrecer **estrategias personalizadas de fidelizaci√≥n**.

El sistema combina:
- **Modelos predictivos supervisados.**
- **API de predicci√≥n en tiempo real (FastAPI).**
- **Dashboard interactivo (Streamlit).**

De este modo, la anal√≠tica avanzada se integra en la gesti√≥n diaria del gimnasio, convirtiendo los datos en **decisiones accionables**.

## ‚öôÔ∏è Caracter√≠sticas Principales

- üîç **Modelo Predictivo:** estima la probabilidad de abandono de cada abonado mediante aprendizaje supervisado.  
- üß© **Arquitectura modular reproducible:** basada en principios MLOps con trazabilidad completa.  
- üöÄ **API de inferencia (FastAPI):** permite realizar predicciones en tiempo real.  
- üìä **Dashboard interactivo (Streamlit):** visualiza niveles de riesgo y sugiere acciones de fidelizaci√≥n.  
- üßÆ **Gesti√≥n de experimentos (MLflow):** registro de m√©tricas, artefactos y versiones de modelos.  
- üîê **Cumplimiento RGPD:** uso exclusivo de datos anonimizados y respetuosos con la privacidad.


## üìå Objetivos:

### Objetivo general:

Desarrollar un **sistema predictivo de abandono** que permita al CEM Horta anticipar bajas y dise√±ar **acciones de retenci√≥n personalizadas basadas en datos**.


### Objetivos espec√≠ficos:
1. Analizar patrones de comportamiento, asistencia y actividad de los abonados.
2. Segmentar los usuarios seg√∫n frecuencia, antig√ºedad, gasto y nivel de compromiso.
3. Entrenar modelos de machine learning para predecir la probabilidad de abandono.
4. Evaluar su rendimiento mediante m√©tricas robustas (AUC-ROC, F1-score, Recall).
5. Desarrollar una **API y un dashboard interactivo** para la visualizaci√≥n y toma de decisiones.
6. Clasificar los resultados en **niveles de riesgo** (**muy bajo, bajo, medio, alto y muy alto**) y asociar a cada uno **acciones recomendadas** de fidelizaci√≥n.


### üèóÔ∏è Arquitectura del proyecto

El proyecto sigue una metodolog√≠a modular basada en **CRISP-DM** y principios de **MLOps**, garantizando la trazabilidad, reproducibilidad y escalabilidad del sistema.

> üì∑ **Figura 1. Arquitectura general del sistema**  

![alt text](streamlit/assets/Arquitectura_proyecto.drawio.png)

Resumen de la arquitectura:

1. Pipeline ETL y Feature Engineering:

    - Limpieza, codificaci√≥n, normalizaci√≥n y c√°lculo de m√©tricas de asistencia y econ√≥micas.
    - Integraci√≥n final en dataframe_final_abonado.csv.

2. Modelado:

    - Modelos evaluados: Gradient Boosting, Random Forest, SVM, Regresi√≥n Log√≠stica, KNN.
    - Optimizaci√≥n con GridSearchCV, priorizando Recall y AUC.
    - Registro y trazabilidad con MLflow.

3. API FastAPI:

    - Endpoints para predicci√≥n individual, batch y simulada.
    - Devuelve clase, probabilidad, nivel de riesgo y variables explicativas.
    > üì∑ **Figura 2. Flujo interno de predicci√≥n en la API**  

    ![alt text](streamlit/assets/Flujo_interno_API.drawio.png)

4. Dashboard Streamlit:

    - Consultas por ID, batch y simulaci√≥n.
    - Visualizaci√≥n de riesgo, importancia de variables y estrategias de fidelizaci√≥n.


## üìä 7. Resultados y an√°lisis


### Distribuci√≥n de abandonos

- Total de abonados: 6.929
- Abandono (EsChurn = 1): 2.504 (36%)
- Activos (EsChurn = 0): 4.425 (64%)

‚ö†Ô∏è Existe un desbalance moderado que justifica priorizar recall en los modelos sin necesidad de oversampling.

### Experimentos y selecci√≥n de variables

Se realizaron 3 experimentos para evaluar la relevancia de las variables y evitar multicolinealidad:

| Experimento | Variables destacadas                              | Objetivo                                               |
| ----------- | ------------------------------------------------- | ------------------------------------------------------ |
| 1           | Todas (incluye TotalPagadoEconomia, VidaGymMeses) | M√°ximo rendimiento                                     |
| 2           | Sin TotalPagadoEconomia                           | Reducir dependencia econ√≥mica                          |
| 3           | Sin TotalPagadoEconomia ni VidaGymMeses           | Foco en comportamiento real (visitas, actividad, edad) |


Variables econ√≥micas y de antig√ºedad muestran alta correlaci√≥n, pudiendo sesgar los modelos.

### Modelos y m√©tricas clave

Resumen de los mejores modelos: Gradient Boosting, Random Forest y SVM.

| Modelo            | Exp | Accuracy | Recall | F1    | AUC   |
| ----------------- | --- | -------- | ------ | ----- | ----- |
| Gradient Boosting | 1   | 0.934    | 0.888  | 0.924 | 0.979 |
| Gradient Boosting | 2   | 0.882    | 0.822  | 0.863 | 0.950 |
| Gradient Boosting | 3   | 0.829    | 0.786  | 0.806 | 0.911 |


‚úÖ Gradient Boosting se destaca en todos los experimentos, con alto recall, clave para detectar abandonos.

### üìà Validaci√≥n externa

| Experimento | Accuracy | Recall | F1    | AUC   |
| ----------- | -------- | ------ | ----- | ----- |
| 1           | 0.811    | 0.945  | 0.834 | 0.807 |
| 2           | 0.756    | 0.884  | 0.784 | 0.754 |
| 3           | 0.795    | 0.844  | 0.804 | 0.874 |


üîπ Experimento 3 logra el mejor equilibrio entre rendimiento t√©cnico y aplicabilidad de negocio.

### üåü Variables m√°s importantes (Top 5)

| Experimento | Variables clave                                                       | Tipo                    |
| ----------- | --------------------------------------------------------------------- | ----------------------- |
| 1           | TotalPagadoEconomia, VidaGymMeses, Edad, TienePagos, TotalVisitas     | Econ√≥micas + antig√ºedad |
| 2           | VidaGymMeses, D√≠asActivo, TotalVisitas, EstFav_verano, Edad           | Actividad + antig√ºedad  |
| 3           | D√≠asActivo, TotalVisitas, Edad, VisitasPrimerTrimestre, VisitasUlt180 | Comportamiento reciente |


üîπ Exp. 3 permite acciones directas y √©ticas, basadas en actividad y constancia.

### üéØ Modelo final y estrategia

- Modelo elegido: Gradient Boosting (Exp. 3)
- Motivo: Equilibrio entre precisi√≥n, interpretabilidad y aplicabilidad.
- Uso: Alimenta la API y el dashboard para identificar abonados en riesgo y recomendar acciones de fidelizaci√≥n.

Niveles de riesgo y estrategias recomendadas:

| Nivel de Riesgo | Estrategias Recomendadas                                                                                                                                                                                                                                                |
| --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Muy Bajo**    | 1. Programa de recompensas por uso continuo.<br>2. Acceso anticipado a nuevas funcionalidades.<br>3. Beneficios por referencia.<br>4. Ofertas personalizadas seg√∫n h√°bitos.<br>5. Eventos exclusivos o retos para socios fieles                                         |
| **Bajo**        | 1. Descuentos en renovaci√≥n.<br>2. Campa√±as de retargeting personalizadas.<br>3. Notificaciones con recordatorios de valor.<br>4. Descuentos por uso frecuente.<br>5. Recompensas por explorar nuevas funciones                                                         |
| **Medio**       | 1. Ofertas de reactivaci√≥n personalizadas.<br>2. Recordatorios de funcionalidades no usadas.<br>3. Campa√±as de contenido exclusivo.<br>4. Acceso temporal a servicios premium.<br>5. Notificaciones de ‚Äú√∫ltima oportunidad‚Äù                                             |
| **Alto**        | 1. Descuentos agresivos en reactivaci√≥n.<br>2. Contacto personalizado (correo, llamada o asesoramiento).<br>3. Planes flexibles seg√∫n uso.<br>4. Campa√±as urgentes de reactivaci√≥n.<br>5. Sesiones de soporte o entrenamiento gratuito                                  |
| **Muy Alto**    | 1. Descuentos masivos o acceso gratuito temporal.<br>2. Encuestas de salida con incentivos.<br>3. Reactivaci√≥n por comunicaci√≥n directa (SMS o llamada).<br>4. Experiencia guiada de reactivaci√≥n.<br>5. Plan gratuito por tiempo limitado con onboarding personalizado |


## üìä Clasificaci√≥n de riesgo

El modelo devuelve una probabilidad de abandono, que se traduce en niveles de riesgo operativos integrados en la API y el dashboard.

| Probabilidad | Nivel de riesgo | Interpretaci√≥n                                          |
| ------------ | --------------- | ------------------------------------------------------- |
| 0.00 ‚Äì 0.20  | Muy bajo     | Cliente fidelizado, sin se√±ales de riesgo.              |
| 0.21 ‚Äì 0.40  | Bajo         | Riesgo leve, seguimiento trimestral.                    |
| 0.41 ‚Äì 0.60  | Medio        | Riesgo moderado, acciones de fidelizaci√≥n recomendadas. |
| 0.61 ‚Äì 0.80  | Alto         | Riesgo alto, intervenci√≥n proactiva recomendada.        |
| 0.81 ‚Äì 1.00  | Muy alto     | Riesgo cr√≠tico, contacto inmediato necesario.           |


## ‚úÖ Conclusiones generales

- T√©cnicas:
    - Gradient Boosting ofrece el mejor balance entre desempe√±o y accionabilidad.
    - Variables de comportamiento como d√≠as activos y visitas son m√°s √∫tiles que variables econ√≥micas o antig√ºedad para intervenci√≥n operativa.

- De negocio:
    - La herramienta permite priorizar recursos y dise√±ar campa√±as de retenci√≥n segmentadas y medibles.
    - La comunicaci√≥n debe ser transparente y respetar la privacidad de los abonados.

- Aportaciones:
    - Pipeline ETL reproducible, explicabilidad por importancia de metricas, API REST y dashboard Streamlit para usuarios no t√©cnicos.
    - Buenas pr√°cticas de gobernanza de datos y trazabilidad aplicables a proyectos municipales.

- L√≠neas futuras:
    - Despliegue completo en producci√≥n con monitorizaci√≥n, feedback loop y A/B testing de intervenciones.
    - Integraci√≥n de nuevas fuentes de datos y mejora de modelos con t√©cnicas avanzadas.

### üéì Reflexi√≥n personal y profesional

Este TFM ha supuesto un aprendizaje profundo tanto t√©cnico como personal. Profesionalmente, me ha permitido desarrollar competencias en ingenier√≠a de datos, modelado predictivo, despliegue de soluciones (API y dashboard) y comprender la importancia de la gobernanza, trazabilidad y √©tica en IA.

A nivel personal, ha sido un ejercicio de constancia, autonom√≠a y pensamiento cr√≠tico, mostrando la complejidad de llevar modelos a producci√≥n y la necesidad de traducir resultados t√©cnicos en decisiones accionables para equipos no especializados.

La colaboraci√≥n con el centro deportivo reforz√≥ la idea de que la IA es una herramienta de apoyo, nunca un sustituto del criterio profesional, y consolid√≥ mi inter√©s por la ciencia de datos aplicada al √°mbito social y deportivo.


## Interacci√≥n del usuario final

> üì∑ **Figura 3. Flujo de usuario**  

![alt text](streamlit/assets/Flujo_de_usuario.drawio.png)

El director puede acceder al dashboard, consultar predicciones de riesgo y recibir recomendaciones de fidelizaci√≥n, cerrando el ciclo entre inferencia, visualizaci√≥n y acci√≥n sobre los abonados.


##  üõ† Herramientas utilizadas

- üìà Excel ‚Üí An√°lisis inicial y control de datos fuente.
- üß∞ Python >=3.10 (VSCode)  ‚Üí Desarrollo y ejecuci√≥n modular (librer√≠as principales: `pandas`, `numpy`, `scikit-learn`, `mlflow`, `fastapi`, `streamlit`). 
- üßÆ MLFlow ‚Üí Gesti√≥n de experimentos, m√©tricas y artefactos.
- ‚ö° FastAPI ‚Üí Despliegue del modelo como servicio REST.
- üìä Streamlit ‚Üí Dashboard interactivo para gestores.


## üìÅ Estructura del proyecto

```plaintext
TFM_FINAL/
‚îÇ
‚îú‚îÄ‚îÄdata/                              # Datos originales y procesados
‚îÇ   ‚îú‚îÄ‚îÄ dataframe_final_abonado.csv   
‚îÇ   ‚îú‚îÄ‚îÄ df_validacion_abonado.csv     
‚îÇ
‚îú‚îÄ‚îÄ eda_feature_engineering/            # M√≥dulos ETL y Feature Engineering
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py         
‚îÇ   ‚îú‚îÄ‚îÄ abonados.py                   
‚îÇ   ‚îú‚îÄ‚îÄ accesos.py                    
‚îÇ   ‚îú‚îÄ‚îÄ archivo_final.py              
‚îÇ   ‚îú‚îÄ‚îÄ economia.py                   
‚îÇ   ‚îú‚îÄ‚îÄ funciones.py                  
‚îÇ   ‚îú‚îÄ‚îÄ servicios.py                 
‚îÇ   ‚îî‚îÄ‚îÄ main.py                         
|
‚îú‚îÄ‚îÄmlops_api/                                      # Entrenamiento, inferencia y API
‚îÇ   ‚îú‚îÄ‚îÄ data_mlops_api/                            
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inferencia_predicciones_exp1/          
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inferencia_predicciones_exp2/          
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ inferencia_predicciones_exp3/          
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dataframe_final_aboando.csv            
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ df_validacion_Experimento_v1.csv       
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ df_validacion_Experimento_v2.csv       
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ df_validacion_Experimento_v3.csv       
|   |
‚îÇ   ‚îú‚îÄ‚îÄ scr/                     
‚îÇ   |   ‚îú‚îÄ‚îÄ api/                        # Ejecuci√≥n de la API.
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ columnas_modelo3.txt    
|   |   |   ‚îî‚îÄ‚îÄ main_app.py             
|   |   |
‚îÇ   |   ‚îú‚îÄ‚îÄ load_data/                  # Carga de los datos.
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
|   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ loader.py               
|   |   |
‚îÇ   |   ‚îú‚îÄ‚îÄ models/                     # Definici√≥n de los modelos
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py             
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ registry.py             
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ train.py                
|   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validate.py             
|   |   |
‚îÇ   |   ‚îú‚îÄ‚îÄ utils/                      # Contenido axuliar para el uso artefactos, metricas y plots de visualizaci√≥n.
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py 
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ artifacts.py            
|   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics.py              
|   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ plotting.py             
|   |   |
‚îÇ   |   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   |   ‚îú‚îÄ‚îÄ config.py                   # Rutas de entrada y salida de los datos y caracter√≠sticas a utilizar.
|   |   |
‚îÇ   |   ‚îú‚îÄ‚îÄ temp_artifacts/             # Carpeta para guardar el scaler con el modelo final.
‚îÇ   |   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   |   ‚îú‚îÄ‚îÄ main_train.py               # Archivo python con el contenido para ejecutar el entrenamiento de los experimentos/modelos. 
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main_validate.py            # Archivo python con el contenido para ejecutar la validaci√≥n/inferencia de los experimentos/modelos. 
|   |
‚îÇ   ‚îú‚îÄ‚îÄ mlruns/                         # Guardado de los artefactos, caracter√≠sticas, metricas de todos los entrenamientos y inferencias ejecutadas.
‚îÇ   ‚îú‚îÄ‚îÄ streamlit/                      # Ejecuci√≥nd ela interfaz para el director del centro.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/                     
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ funciones_stremlit.py       
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ streamlit.py                
|   |
‚îÇ   ‚îî‚îÄ‚îÄ temp_artifacts/  
‚îÇ
‚îú‚îÄ‚îÄ LICENSE.py                      # Archivo de configuraci√≥n para empaquetar
‚îú‚îÄ‚îÄ README.md                       # Este archivo.
‚îî‚îÄ‚îÄ requirements.txt                # Dependencias del proyecto
```

## üöÄ Ejecucci√≥n del proyecto:

```bash
# 1.  Crear entorno 
python -m venv tfm_venv
tfm_venv/scripts/activate
pip install -r requirements.txt #Instalar dependencias necesarias

# 2. ETL + Feature Engineering
python eda_feature_engineering/main.py

# 3. Entrenamiento
python mlops_api/main_train.py

# 4. Inferencia externa
python mlops_api/main_validate.py

# 5. Ejecutar API
uvicorn mlops_api.scr.api.main_app:app

# 6. Dashboard Streamlit
streamlit run mlops_api/streamlit/streamlit.py
```

----
## Licencia 
Este proyecto est√° licenciado bajo la Licencia MIT.

----
## Autor
Cesc Blanco Arnau. 

üë§ [LinkedIn](www.linkedin.com/in/cescblanco)
üìß [Correo](cesc.blanco98@gmail.com)
üîó [GitHub](https://github.com/CescBlanco)

üéì M√°ster en Data Science & IA ‚Äì [Evolve Academy](https://evolveacademy.es/)
üìç Proyecto aplicado en colaboraci√≥n con [CEM Horta](https://www.hortaesportiva.cat/), Barcelona
